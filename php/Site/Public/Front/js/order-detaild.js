!function(e){function i(l){if(t[l])return t[l].exports;var n=t[l]={exports:{},id:l,loaded:!1};return e[l].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}var t={};return i.m=e,i.c=t,i.p="js/",i(0)}([function(e,i,t){function l(e){$.post($domain+"/Order/getOrderDetail",{orderId:e},function(e){"000"==e.code&&(html=template("tp-order-detail",e),$("#order-detail").html(html),$(".order-print").click(function(){var e=$(this).attr("href"),i=$(this).attr("rid");return window.location.href=e+"#"+i,!1}),$(".order-cancel").click(function(){var e=$(this),i=e.attr("rid");return $.post($domain+"/order/closeOrder",{orderId:i},function(e){alert(e.message),"000"==e.code&&l(i)},"json"),!1}),$(".order-confirm").click(function(){var e=$(this),i=e.attr("rid");return $.post($domain+"/Order/confirmOrder",{orderId:i},function(e){alert(e.message),"000"==e.code&&l(i)},"json"),!1}),$(".fileUploadContent").each(function(e,i){$(this).initUpload({uploadUrl:"#",maxFileNumber:5})}))},"json")}var n=(t(3),location.hash),o=n.substring(1);o.length>0?l(o):alert("param is required")},,,function(e,i){$.fn.extend({initUpload:function(e){if("object"!=typeof e)return void alert("参数错误!");var i=$(this).attr("id");null!=i&&""!=i||alert("要设定一个id!"),$.each(t.getInitOption(i),function(i,t){null==e[i]&&(e[i]=t)}),t.initWithLayout(e),t.initWithDrag(e),t.initWithSelectFile(e),t.initWithUpload(e),t.initWithCleanFile(e),n.initFileList()}});var t={getInitOption:function(e){var i={uploadId:e,uploadUrl:"#",progressUrl:"#",autoCommit:!1,canDrag:!0,fileType:"*",size:"-1",ismultiple:!0,showSummerProgress:!0,filelSavePath:"",beforeUpload:function(){},onUpload:function(){}};return i},initWithUpload:function(e){var i=e.uploadId;$("#"+i+" .uploadBts .uploadFileBt").on("click",function(){l.uploadFileEvent(e)}),$("#"+i+" .uploadBts .uploadFileBt i").css("color","#0099FF")},initWithCleanFile:function(e){var i=e.uploadId;$("#"+i+" .uploadBts .cleanFileBt").on("click",function(){l.cleanFileEvent(e)}),$("#"+i+" .uploadBts .cleanFileBt i").css("color","#0099FF")},initWithSelectFile:function(e){var i=e.uploadId;$("#"+i+" .uploadBts .selectFileBt").on("click",function(){l.selectFileEvent(e)})},getShowFileType:function(e,i,t,l,n,o){var a="<div class='fileType'>"+i+"</div> <i class='iconfont icon-wenjian'></i><input type='hidden' name='"+o+"[]' value='"+l+"'/>";e&&null!=l&&"null"!=l&&""!=l&&(a="<img src='"+l+"'/><input type='hidden' name='"+o+"[]' value='"+l+"'/>");var r="";return r+="<div class='fileItem mui-clearfix'  fileCodeId='"+n+"'>",r+="<div class='imgShow'>",r+=a,r+=" </div>",r+=" <div class='progress'>",r+="<div class='progress_inner'></div>",r+="</div>",r+="<div class='status'>",r+="<i class='mui-icon mui-icon-closeempty'></i>",r+="</div>",r+=" <div class='fileName'>",r+=t,r+="</div>",r+=" </div>"},initWithLayout:function(e){var i=e.uploadId,t="<div class='box'></div>";$("#"+i).append(t);var l="";if(l+="<div class='uploadBts'>",l+="<div>",l+="<div class='selectFileBt'>选择文件</div>",l+="</div>",l+="<div class='uploadFileBt'>",l+="<i class='iconfont icon-shangchuan'></i>",l+=" </div>",l+="<div class='cleanFileBt'>",l+="<i class='iconfont icon-qingchu'></i>",l+=" </div>",l+="</div>",$("#"+i).append(l),e.showSummerProgress){var n="<div class='subberProgress'>";n+="<div class='progress'>",n+="<div>0%</div>",n+="</div>",n+=" </div>",$("#"+i).append(n)}},initWithDrag:function(e){var i=e.canDrag,t=e.uploadId;if(i){$(document).on({dragleave:function(e){e.preventDefault()},drop:function(e){e.preventDefault()},dragenter:function(e){e.preventDefault()},dragover:function(e){e.preventDefault()}});var n=$("#"+t+" .box").get(0);null!=n&&n.addEventListener("drop",function(i){l.dragListingEvent(i,e)})}},initWithDeleteFile:function(e){var i=e.uploadId;$("#"+i+" .fileItem .status i").on("click",function(){l.deleteFileEvent(e,this)})},getSuffixNameByFileName:function(e){var i=e,t=i.lastIndexOf(".")+1,l=i.substring(t,i.length);return l},isInArray:function(e,i){for(var t=!1,l=0;l<i.length;l++)if(e==i[l]){t=!0;break}return t},fileIsExit:function(e,i){for(var t=n.getFileList(i.uploadId),l=!1,o=0;o<t.length;o++)null!=t[o]&&t[o].name==e.name&&t[o].size==e.size&&(l=!0);return l},addFileList:function(e,i){var l=i.uploadId,o=$("#"+l+" .box").get(0),a=n.getFileList(i.uploadId),r=t.getFileNumber(i);if(r+e.length>i.maxFileNumber)return void alert("最多只能上传"+i.maxFileNumber+"个文件");for(var s=/image\/(\w)*/,d=i.fileType,u=i.size,c=0;c<e.length;c++)if(t.fileIsExit(e[c],i))alert("文件（"+e[c].name+"）已经存在！");else{var f=t.getSuffixNameByFileName(e[c].name);if(u!=-1&&e[c].size>1e3*u)alert("文件（"+e[c].name+"）超出了大小限制！请控制在"+u+"KB内");else if("*"==d||t.isInArray(f,d)){var p=f.toUpperCase(),v="";if(void 0!=window.createObjectURL?v=window.createObjectURL(e[c]):void 0!=window.URL?v=window.URL.createObjectURL(e[c]):void 0!=window.webkitURL&&(v=window.webkitURL.createObjectURL(e[c])),s.test(e[c].type)){var g=t.getShowFileType(!0,p,e[c].name,v,a.length,l);$(o).append(g)}else{var g=t.getShowFileType(!1,p,e[c].name,v,a.length,l);$(o).append(g)}t.initWithDeleteFile(i),a[a.length]=e[c]}else alert("不支持该格式文件上传:"+e[c].name)}n.setFileList(a,i.uploadId)},cleanFilInputWithSelectFile:function(e){var i=e.uploadId;$("#"+i+"_file").remove()},showUploadProgress:function(e,i,t){var l=e.uploadId,o=n.getFileList(e.uploadId);if(e.showSummerProgress){var a=$("#"+l+" .subberProgress .progress>div");a.css("width",t+"%"),a.html(t+"%")}for(var r=0;r<o.length;r++)if(null!=o[r]){var s=i-o[r].size;if(s<0){if(100!=t){$("#"+l+" .box .fileItem[fileCodeId='"+r+"'] .progress>div").css("width",i/o[r].size*100+"%");break}$("#"+l+" .box .fileItem[fileCodeId='"+r+"'] .progress>div").addClass("error"),$("#"+l+" .box .fileItem[fileCodeId='"+r+"'] .progress>div").css("width","100%"),$("#"+l+" .box .fileItem[fileCodeId='"+r+"'] .status>i").addClass("iconfont icon-cha"),i-=o[r].size}else s>=0&&($("#"+l+" .box .fileItem[fileCodeId='"+r+"'] .status>i").addClass("iconfont icon-gou"),$("#"+l+" .box .fileItem[fileCodeId='"+r+"'] .progress>div").css("width","100%"),i-=o[r].size)}},uploadError:function(e){var i=e.uploadId;$("#"+i+" .box .fileItem .progress>div").addClass("error"),$("#"+i+" .box .fileItem .progress>div").css("width","100%"),$("#"+i+" .box .fileItem .status>i").addClass("iconfont icon-cha");var t=$("#"+i+" .subberProgress .progress>div");t.css("width","0%"),t.html("0%")},uploadFile:function(e){var i=e.uploadUrl,l=n.getFileList(e.uploadId),o=new FormData,a=t.getFileNumber(e);if(a<=0)return void alert("没有文件，不支持上传");for(var r=0;r<l.length;r++)null!=l[r]&&o.append("file",l[r]);o.append("filelSavePath",e.filelSavePath),"#"!=i&&""!=i?(t.disableFileUpload(e),t.disableCleanFile(e),$.ajax({type:"post",url:i,data:o,processData:!1,contentType:!1,success:function(i){setTimeout(function(){e.onUpload(e,i)},500)},error:function(e){}})):(t.disableFileUpload(e),t.disableCleanFile(e)),t.getFileUploadPregressMsg(e)},getFileUploadPregressMsg:function(e){var i=e.uploadId,l=e.progressUrl;if(e.showSummerProgress&&$("#"+i+" .subberProgress").css("display","block"),$("#"+i+" .box .fileItem .status>i").removeClass(),"#"!=l&&""!=l)var n=setInterval(function(){$.get(l,{},function(i,l){console.log(i);var o=i.percent,a=i.bytesRead;o>=100&&(clearInterval(n),o=100,t.initWithCleanFile(e)),t.showUploadProgress(e,a,o)},"json")},500);else var o=0,a=0,n=setInterval(function(){o+=5,a+=5e4,o>=100&&(clearInterval(n),o=100,t.initWithCleanFile(e)),t.showUploadProgress(e,a,o)},500)},disableFileUpload:function(e){var i=e.uploadId;$("#"+i+" .uploadBts .uploadFileBt").off(),$("#"+i+" .uploadBts .uploadFileBt i").css("color","#DDDDDD")},disableCleanFile:function(e){var i=e.uploadId;$("#"+i+" .uploadBts .cleanFileBt").off(),$("#"+i+" .uploadBts .cleanFileBt i").css("color","#DDDDDD")},getFileNumber:function(e){for(var i=0,t=n.getFileList(e.uploadId),l=0;l<t.length;l++)null!=t[l]&&i++;return i}},l={dragListingEvent:function(e,i){e.preventDefault();var n=e.dataTransfer.files;t.addFileList(n,i),i.autoCommit&&l.uploadFileEvent(i)},deleteFileEvent:function(e,i){var t=$(i).parent().parent(),l=t.attr("fileCodeId"),o=n.getFileList(e.uploadId);delete o[l],n.setFileList(o,e.uploadId),t.remove()},selectFileEvent:function(e){var i=e.uploadId,t=e.ismultiple,n=document.createElement("input");n.setAttribute("id",i+"_file"),n.setAttribute("type","file"),n.setAttribute("style","visibility:hidden"),t&&n.setAttribute("multiple","multiple"),$(n).on("change",function(){l.selectFileChangeEvent(this.files,e)}),document.body.appendChild(n),n.click()},selectFileChangeEvent:function(e,i){t.addFileList(e,i),t.cleanFilInputWithSelectFile(i),i.autoCommit&&l.uploadFileEvent(i)},uploadFileEvent:function(e){e.beforeUpload(e),t.uploadFile(e)},cleanFileEvent:function(e){var i=e.uploadId;e.showSummerProgress&&($("#"+i+" .subberProgress").css("display","none"),$("#"+i+" .subberProgress .progress>div").css("width","0%"),$("#"+i+" .subberProgress .progress>div").html("0%")),t.cleanFilInputWithSelectFile(e),n.setFileList([],e.uploadId),$("#"+i+" .box").html(""),t.initWithUpload(e)}},n={fileList:{},initFileList:function(){n.fileList={}},getFileList:function(e){return void 0==e?[]:(void 0==n.fileList[e]&&(n.fileList[e]=new Array),n.fileList[e])},setFileList:function(e,i){void 0==n.fileList[i]&&(n.fileList[i]=new Array),n.fileList[i]=e}}}]);